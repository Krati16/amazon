{"ast":null,"code":"\"use strict\";\n\nvar __spreadArray = this && this.__spreadArray || function (to, from) {\n  for (var i = 0, il = from.length, j = to.length; i < il; i++, j++) to[j] = from[i];\n  return to;\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.create = void 0;\nvar ctrl_or_cmd_1 = require(\"../ctrl-or-cmd\");\nvar event_loop_1 = require(\"../event-loop\");\nvar util = require(\"../util\");\nvar elementClass = require('element-class');\nfunction create(grid) {\n  var wasSelectedAtMousedown;\n  var model = {\n    _dragRects: [],\n    _onMousedown: function (e) {\n      if (!isTargetingColHeader(e)) {\n        return;\n      }\n      var colDescriptor = grid.data.col.get(e.col);\n      wasSelectedAtMousedown = colDescriptor && !!colDescriptor.selected;\n      if (wasSelectedAtMousedown && !ctrl_or_cmd_1.default(e)) {\n        grid.eventLoop.stopBubbling(e);\n      }\n    },\n    _onDragStart: function (e) {\n      if (!isTargetingColHeader(e) || e.realCol < grid.colModel.numFixed() || !wasSelectedAtMousedown) {\n        return;\n      }\n      var colDescriptor = grid.view.col.get(e.realCol);\n      if (!colDescriptor || colDescriptor.selectable === false) {\n        return;\n      }\n      if (e.enableAutoScroll) {\n        e.enableAutoScroll();\n      }\n      grid.eventLoop.stopBubbling(e);\n      var startCol = e.virtualCol;\n      model._targetCol = grid.decorators.create(0, undefined, Infinity, 1, 'cell', 'real');\n      model._targetCol.postRender = function (div) {\n        div.setAttribute('class', 'grid-reorder-target');\n        if (!model._targetCol) {\n          console.error('somehow targetCol was set back to undefined before post render');\n          return;\n        }\n        model._targetCol._renderedElem = div;\n      };\n      grid.decorators.add(model._targetCol);\n      var selected = grid.colModel.getSelected();\n      model._dragRects = selected.map(function (dataCol) {\n        var viewCol = grid.data.col.toView(dataCol);\n        var dragRect = grid.decorators.create(0, undefined, Infinity, undefined, 'px', 'real');\n        dragRect.fixed = true;\n        dragRect.colOffset = e.gridX - grid.viewPort.getColLeft(viewCol);\n        dragRect.postRender = function (div) {\n          div.setAttribute('class', 'grid-drag-rect');\n        };\n        dragRect.width = grid.viewPort.getColWidth(viewCol);\n        return dragRect;\n      });\n      grid.decorators.add(model._dragRects);\n      model._unbindKeyDown = grid.escapeStack.add(removeDecoratorsAndUnbind);\n      model._unbindDrag = grid.eventLoop.bind('grid-drag', function (gridDragEvent) {\n        model._dragRects.forEach(function (dragRect) {\n          dragRect.left = util.clamp(gridDragEvent.gridX - dragRect.colOffset, grid.viewPort.getColLeft(grid.colModel.numFixed()), Infinity);\n        });\n        if (!model._targetCol) {\n          console.error('somehow targetCol was set back to undefined before drag');\n          return;\n        }\n        model._targetCol.left = util.clamp(gridDragEvent.realCol, grid.colModel.numFixed(), Infinity);\n        model._targetCol.moveAfter = gridDragEvent.realCol > startCol;\n        if (model._targetCol.moveAfter) {\n          elementClass(model._targetCol._renderedElem).add('right');\n        } else {\n          elementClass(model._targetCol._renderedElem).remove('right');\n        }\n      });\n      model._unbindDragEnd = grid.eventLoop.bind('grid-drag-end', function () {\n        if (!model._targetCol) {\n          console.error('somehow targetCol was set to undefined before drag end');\n          return;\n        }\n        var targetDataCol = model._targetCol.left;\n        if (targetDataCol !== undefined) {\n          grid.colModel.move(selected.map(function (dataCol) {\n            return grid.data.col.toVirtual(dataCol);\n          }), grid.viewPort.toVirtualCol(targetDataCol), model._targetCol.moveAfter);\n        }\n        removeDecoratorsAndUnbind();\n      });\n      function removeDecoratorsAndUnbind() {\n        if (model._targetCol) {\n          var removedDecs = __spreadArray(__spreadArray([], model._dragRects), [model._targetCol]);\n          grid.decorators.remove(removedDecs);\n        }\n        if (model._unbindDrag) {\n          model._unbindDrag();\n        }\n        if (model._unbindDragEnd) {\n          model._unbindDragEnd();\n        }\n        if (model._unbindKeyDown) {\n          model._unbindKeyDown();\n        }\n        return true;\n      }\n    }\n  };\n  function isTargetingColHeader(e) {\n    return e && e.row < 0;\n  }\n  grid.eventLoop.bind('grid-drag-start', model._onDragStart);\n  grid.eventLoop.addInterceptor(function (e) {\n    if (event_loop_1.isAnnotatedMouseEventOfType(e, 'mousedown')) {\n      model._onMousedown(e);\n    }\n  });\n  return model;\n}\nexports.create = create;\nexports.default = create;","map":{"version":3,"names":["ctrl_or_cmd_1","require","event_loop_1","util","elementClass","create","grid","wasSelectedAtMousedown","model","_dragRects","_onMousedown","e","isTargetingColHeader","colDescriptor","data","col","get","selected","default","eventLoop","stopBubbling","_onDragStart","realCol","colModel","numFixed","view","selectable","enableAutoScroll","startCol","virtualCol","_targetCol","decorators","undefined","Infinity","postRender","div","setAttribute","console","error","_renderedElem","add","getSelected","map","dataCol","viewCol","toView","dragRect","fixed","colOffset","gridX","viewPort","getColLeft","width","getColWidth","_unbindKeyDown","escapeStack","removeDecoratorsAndUnbind","_unbindDrag","bind","gridDragEvent","forEach","left","clamp","moveAfter","remove","_unbindDragEnd","targetDataCol","move","toVirtual","toVirtualCol","removedDecs","__spreadArray","row","addInterceptor","isAnnotatedMouseEventOfType","exports"],"sources":["C:\\amazon\\amazon\\node_modules\\grid\\src\\modules\\col-reorder\\index.ts"],"sourcesContent":["import { Grid } from '../core';\nimport ctrlOrCmd from '../ctrl-or-cmd';\nimport { IDecorator } from '../decorators';\nimport { AnnotatedMouseEventUnion, IAnnotatedEvent, IGridDragStartEvent, isAnnotatedMouseEventOfType } from '../event-loop';\nimport * as util from '../util';\n\nconst elementClass = require('element-class');\n\nexport interface ITargetCol extends IDecorator {\n    _renderedElem?: HTMLElement;\n    moveAfter?: boolean;\n}\n\nexport interface IDragRect extends IDecorator {\n    colOffset: number;\n}\n\nexport interface IColReorder {\n    _targetCol?: ITargetCol;\n    _dragRects: IDragRect[];\n    _onMousedown(e: AnnotatedMouseEventUnion): void;\n    _onDragStart(e: IGridDragStartEvent): void;\n    _unbindKeyDown?(): void;\n    _unbindDrag?(): void;\n    _unbindDragEnd?(): void;\n}\n\nexport function create(grid: Grid) {\n    let wasSelectedAtMousedown: boolean | undefined;\n    const model: IColReorder = {\n        _dragRects: [],\n        _onMousedown(e: AnnotatedMouseEventUnion) {\n            if (!isTargetingColHeader(e)) {\n                return;\n            }\n\n            const colDescriptor = grid.data.col.get(e.col);\n            wasSelectedAtMousedown = colDescriptor && !!colDescriptor.selected;\n            if (wasSelectedAtMousedown && !ctrlOrCmd(e)) {\n                grid.eventLoop.stopBubbling(e);\n            }\n        },\n        _onDragStart(e: IGridDragStartEvent) {\n\n            if (!isTargetingColHeader(e) || e.realCol < grid.colModel.numFixed() || !wasSelectedAtMousedown) {\n                return;\n            }\n\n            const colDescriptor = grid.view.col.get(e.realCol);\n            if (!colDescriptor || colDescriptor.selectable === false) {\n                return;\n            }\n            if (e.enableAutoScroll) {\n                e.enableAutoScroll();\n            }\n            // we want to be the only draggers\n            grid.eventLoop.stopBubbling(e);\n\n            const startCol = e.virtualCol;\n\n            // create the target line\n            model._targetCol = grid.decorators.create(0, undefined, Infinity, 1, 'cell', 'real');\n            model._targetCol.postRender = (div) => {\n                div.setAttribute('class', 'grid-reorder-target');\n                if (!model._targetCol) {\n                    console.error('somehow targetCol was set back to undefined before post render');\n                    return;\n                }\n                model._targetCol._renderedElem = div;\n            };\n            grid.decorators.add(model._targetCol);\n\n            // create a decorator for each selected col\n            const selected = grid.colModel.getSelected();\n            model._dragRects = selected.map((dataCol) => {\n                const viewCol = grid.data.col.toView(dataCol);\n                const dragRect = grid.decorators.create(0, undefined, Infinity, undefined, 'px', 'real') as IDragRect;\n                dragRect.fixed = true;\n                dragRect.colOffset = e.gridX - grid.viewPort.getColLeft(viewCol);\n                dragRect.postRender = (div) => {\n                    div.setAttribute('class', 'grid-drag-rect');\n                };\n                dragRect.width = grid.viewPort.getColWidth(viewCol);\n                return dragRect;\n            });\n\n            grid.decorators.add(model._dragRects);\n\n            model._unbindKeyDown = grid.escapeStack.add(removeDecoratorsAndUnbind);\n\n            model._unbindDrag = grid.eventLoop.bind('grid-drag', (gridDragEvent) => {\n                model._dragRects.forEach((dragRect) => {\n                    dragRect.left = util.clamp(\n                        gridDragEvent.gridX - dragRect.colOffset,\n                        grid.viewPort.getColLeft(grid.colModel.numFixed()),\n                        Infinity\n                    );\n                });\n                if (!model._targetCol) {\n                    console.error('somehow targetCol was set back to undefined before drag');\n                    return;\n                }\n                model._targetCol.left = util.clamp(gridDragEvent.realCol, grid.colModel.numFixed(), Infinity);\n                model._targetCol.moveAfter = gridDragEvent.realCol > startCol;\n                if (model._targetCol.moveAfter) {\n                    elementClass(model._targetCol._renderedElem).add('right');\n                } else {\n                    elementClass(model._targetCol._renderedElem).remove('right');\n                }\n            });\n\n            model._unbindDragEnd = grid.eventLoop.bind('grid-drag-end', () => {\n                if (!model._targetCol) {\n                    console.error('somehow targetCol was set to undefined before drag end');\n                    return;\n                }\n                const targetDataCol = model._targetCol.left;\n\n                if (targetDataCol !== undefined) {\n                    grid.colModel.move(selected.map((dataCol) => {\n                        return grid.data.col.toVirtual(dataCol);\n                    }), grid.viewPort.toVirtualCol(targetDataCol), model._targetCol.moveAfter);\n                }\n                removeDecoratorsAndUnbind();\n            });\n\n            function removeDecoratorsAndUnbind() {\n                if (model._targetCol) {\n                    const removedDecs = [...model._dragRects, model._targetCol];\n                    grid.decorators.remove(removedDecs);\n                }\n                if (model._unbindDrag) {\n                    model._unbindDrag();\n                }\n                if (model._unbindDragEnd) {\n                    model._unbindDragEnd();\n                }\n                if (model._unbindKeyDown) {\n                    model._unbindKeyDown();\n                }\n                return true; // for the escape stack\n            }\n        }\n    };\n\n    function isTargetingColHeader(e: IAnnotatedEvent) {\n        return e && e.row < 0;\n    }\n\n    grid.eventLoop.bind('grid-drag-start', model._onDragStart);\n    grid.eventLoop.addInterceptor((e) => {\n        if (isAnnotatedMouseEventOfType(e, 'mousedown')) {\n            model._onMousedown(e);\n        }\n    });\n\n    return model;\n}\n\nexport default create;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}